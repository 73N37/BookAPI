@startuml
!pragma layout smetana
'https://plantuml.com/class-diagram

class   BookEntity
class   BookDTO
class   BookDAO
class   BookService
class   BookController
class   BookRoute

class BookEntity{
@Getter
@Setter
+ int price
+ String title
+ String author
+ int bookId
+ User user
+ BookEntity(int price, String title, String author, User user)
}

class BookDTO{
@Getter
+ String title
+ String author
+ int bookId
}

class BookDAO {
+   BookDAO(EntityManagerFactory emf)
+   Set<BookEntity>   getAll(Role.ANYONE role)
+   BookEntity        getById(int id, Role.ANYONE role)
+   Set<BookEntity>   getByName(String, Role.ANYONE role)
+   Set<BookEntity>   getByMaxPrice(int maxPrice, Role.ANYONE role)
+   Set<BookEntity>   getByMinPrice(int minPrice, Role.ANYONE role)
+   Set<BookEntity>   getByPriceRange(int minPrice, int maxPrice, Role.ANYONE role)
+   BookEntity putBook(BookEntity entity, User user)
+   BookEntity patchBookUser(int bookId, User user)
+   BookEntity patchBookAdmin(int bookId, User admin)
+   void deleteById(int bookId, Role.MODERATOR role)
}

class BookService{
+ BookService(BookDAO)
+ BookEntity put(BookEntity entity)
+ BookDTO dtoToEntity(BookEntity entity)
+ Set<BookDTO> dtoToEntitySet(Set<BookEntity> books)
+ BookDTO getById(int bookId, Role.ANYONE role)
+ Set<BookDTO> getByName(String, Role.ANYONE role)
+ Set<BookDTO> getByMaxPrice(int maxPrice, Role.ANYONE role)
+ Set<BookDTO> getByMinPrice(int minPrice, Role.ANYONE role)
+ Set<BookDTO> getByPriceRange(int minPrice, int maxPrice, Role.ANYONE role)
+ BookDTO patchBook(int bookId, User user)
+ BookDTO entityToDTO(BookEntity entity)
}

class BookController{
+ BookController(BookService service)
boolean validatePrimaryKey(Integer id)
BookEntity validateEntity(Context ctx)
Handler get(Context ctx)
Handler getAll(Context ctx)
Handler put(Context ctx)
Handler patch(Context ctx)
Handler delete(Context ctx)
}

class BookRoute{
+ BookRoute(BookController controller)
EndpointGroup getRoutes()
}

@enduml